<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Player Manager</title>
  <link rel="icon" type="image/png" href="assets/favicon.png">

  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.5/build/pure-min.css"
    integrity="sha384-LTIDeidl25h2dPxrB2Ekgc9c7sEC3CWGM6HeFmuDNUjX76Ert4Z4IY714dhZHPLd" crossorigin="anonymous">
  <link rel="stylesheet" href="stylesheets/justsome.css">

  <script defer src="/__/firebase/8.2.5/firebase-app.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-auth.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-database.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-storage.js"></script>

  <script defer src="/__/firebase/init.js?useEmulator=true"></script>

  <style>
    #welcomeMsg {
      text-align: center;
      width: 100%;
    }
  </style>

</head>

<body>

  <header>
    <section>
      <img class="pure-img" src="assets/CVRE.png">
      <h1>Player Manager</h1>
    </section>
    <button type="button" id="logoutButton" class="pure-button">Logout</button>
  </header>
  <main>
    <h1 id="welcomeMsg">Welcome!</h1>
    <row class="pure-g">
      <card class="pure-u-1-2 PUTTHECONTENTINTHEMIDDLE">
        <form id="discordForm" class="pure-form pure-form-aligned">
          <fieldset>
            <div class="pure-control-group">
              <label for="discordInput">Discord Username</label>
              <input type="text" id="discordInput" placeholder="Wumpus#0001" required="">
            </div>
            <div class="pure-controls">
              <button type="submit" class="pure-button pure-button-primary">Save</button>
            </div>
          </fieldset>
        </form>
      </card>
      <card class="pure-u-1-2 PUTTHECONTENTINTHEMIDDLE">
        <button type="button" class="pure-button pure-button-primary">Create New Organization</button>
        <button type="button" class="pure-button pure-button-primary">Create New Team</button>
        <button type="button" class="pure-button pure-button-primary">Create New Player</button>
      </card>
    </row>
    <row class="pure-g">
      <card class="pure-u-1-2 PUTTHECONTENTINTHEMIDDLE tableContainer">
        <table class="pure-table">
          <caption>Beat Saber Teams</caption>
          <thead>
            <tr>
              <td>Organization</td>
              <td>Team</td>
              <td>Player</td>
              <td>Email</td>
              <td>Verification Image</td>
              <td>Verified</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="6">No teams yet!</td>
            </tr>
          </tbody>
        </table>
      </card>
      <card class="pure-u-1-2 PUTTHECONTENTINTHEMIDDLE tableContainer">
        <table class="pure-table">
          <caption>Echo Arena Teams</caption>
          <thead>
            <tr>
              <td>Organization</td>
              <td>Team</td>
              <td>Player</td>
              <td>Email</td>
              <td>Verification Image</td>
              <td>Verified</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="6">No teams yet!</td>
            </tr>
          </tbody>
        </table>
      </card>
    </row>
  </main>
  <footer>
    <section class="pure-u-1-2 logoContainer">
      <a href="http://discord.gg/JXbmZjp"><img class="pure-img discordLogo" src="assets/Discord-Logo-White.png"></a>
  </footer>

  <wrapper id="createOrgModal">
    <modal class="PUTTHECONTENTINTHEMIDDLE">
      <form id="orgForm" class="pure-form pure-form-stacked">
        <fieldset>
          <label for="orgNameInput">Organization Name</label>
          <input type="text" id="orgNameInput" placeholder="School of Hard Knocks" required="">
          <label for="orgLogoInput">Organization Logo</label>
          <input type="file" id="orgLogoInput" required="">
          <button type="submit" id="orgSubmitButton" class="pure-button pure-button-primary">Save</button>
          <button type="button" class="pure-button">Cancel</button>
        </fieldset>
      </form>
    </modal>
  </wrapper>

  <wrapper id="createTeamModal">
    <modal class="PUTTHECONTENTINTHEMIDDLE">
      <form id="createTeamForm" class="pure-form pure-form-stacked">
        <fieldset>
          <legend>Create New Team</legend>
          <select>
            <option>Beat Saber</option>
            <option>Echo Arena</option>
          </select>
          <input type="text" placeholder="Team Name" required="">
          <button type="submit" class="pure-button pure-button-primary">Save</button>
          <button type="button" class="pure-button">Cancel</button>
        </fieldset>
      </form>
    </modal>
  </wrapper>

  <wrapper id="createPlayerModal">
    <modal class="PUTTHECONTENTINTHEMIDDLE">
      <form id="createPlayerForm" class="pure-form pure-form-stacked">
        <fieldset>
          <legend>Create New Player</legend>
          <select>
            <option>Beat Saber</option>
            <option>Echo Arena</option>
          </select>
          <select>
            <option>No Teams!</option>
          </select>
          <input type="text" placeholder="Player Name" required="">
          <input type="email" placeholder="Player Email" required="">
          <input type="file" required="">
          <button type="submit" class="pure-button pure-button-primary">Save</button>
          <button type="button" class="pure-button">Cancel</button>
        </fieldset>
      </form>
    </modal>
  </wrapper>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      const auth = firebase.auth();
      const db = firebase.database();
      var currentUser;
      var currentUserData;

      auth.onAuthStateChanged(function (user) {
        if (!user) {
          window.location.replace("/");
        } else {
          currentUser = user;
          db.ref(currentUser.uid).once("value").then((snapshot) => {
            currentUserData = snapshot.val();
            document.getElementById("discordInput").placeholder = currentUserData.discord;
            if (currentUserData.approved) {
              document.getElementById("orgNameInput").removeAttribute("disabled");
              document.getElementById("orgLogoInput").removeAttribute("disabled");
              document.getElementById("orgSubmitButton").removeAttribute("disabled");
            }
          });
        }
      });

      document.getElementById("logoutButton").addEventListener("click", function (event) {
        event.preventDefault();
        auth.signOut()
          .catch((error) => {
            alert(error.message);
          });
      });

      const discordRegex = /^[^@#:`]{2,32}#\d{4}$/u;
      const discordForm = document.getElementById("discordForm");
      const discordInput = document.getElementById("discordInput");

      discordForm.addEventListener("submit", function (event) {
        event.preventDefault();
        let discordAttempt = discordInput.value;
        if (discordRegex.test(discordAttempt)) {
          db.ref(currentUser.uid).update({
            discord: discordAttempt,
          });
          discordForm.reset();
          discordInput.placeholder = discordAttempt;
        } else {
          alert("Discord username is badly formatted.");
        }
      });

      var createOrgForm = document.getElementById("createOrgForm");
      const orgNameInput = document.getElementById("orgNameInput");
      const orgLogoInput = document.getElementById("orLogoInput");

      createOrgForm.addEventListener("submit", function (event) {
        event.preventDefault();
        let orgNameAttempt = orgNameInput.value;
        let orgLogoAttempt = orgLogoInput.files[0];
        if (true) {
          db.ref(currentUser.uid).update({
            orgName: orgNameAttempt,
          });
          let logoUpload = stor.ref(currentUser.uid + "/orgLogo").put(orgLogoAttempt);
          createOrgForm.reset();
          orgNameInput.placeholder = orgNameAttempt;
        }
      });

      var createOrgModalWrapper = document.getElementById("createOrgModalWrapper");

      document.getElementById("").addEventListener("click", function (event) {
        createOrgModalWrapper.style.display = "block";
      });
      document.getElementById("").addEventListener("click", function (event) {
        createOrgModalWrapper.style.display = "none";
        createOrgForm.reset();
      });

      createOrgForm.addEventListener("submit", function (event) {
        event.preventDefault();

      });

      var createTeamModalWrapper = document.getElementById("createTeamModalWrapper");
      var createTeamForm = document.getElementById("createTeamForm");

      document.getElementById("").addEventListener("click", function (event) {
        createTeamModalWrapper.style.display = "block";
      });
      document.getElementById("").addEventListener("click", function (event) {
        createTeamModalWrapper.style.display = "none";
        createTeamForm.reset();
      });

      createTeamForm.addEventListener("submit", function (event) {
        event.preventDefault();

      });

      var createPlayerModalWrapper = document.getElementById("createPlayerModal");
      var createPlayerForm = document.getElementById("createPlayerForm");

      document.getElementById("").addEventListener("click", function (event) {
        createPlayerModalWrapper.style.display = "block";
      });
      document.getElementById("").addEventListener("click", function (event) {
        createPlayerModalWrapper.style.display = "none";
        createPlayerForm.reset();
      });

      createPlayerForm.addEventListener("submit", function (event) {
        event.preventDefault();

      });

    });
  </script>
</body>

</html>