<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>i can't do webdev</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/8.2.5/firebase-app.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-auth.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-database.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-firestore.js"></script>
  <script defer src="/__/firebase/8.2.5/firebase-storage.js"></script>

  <script defer src="/__/firebase/init.js"></script>
</head>

<body>

  <p id="welcomeMsg">Login to access options & manage your teams.</p>

  <div id="unLoggedPanel">
    <form style="display: inline;" id="loginForm">
      <label for="mailInput">Email Address:</label>
      <input id="mailInput" type="email" autocomplete="username">
      <label for="passInput">Password:</label>
      <input id="passInput" type="password" autocomplete="current-password"><br>
      <button type="submit" id="signinButton">Sign-in</button>
    </form>

    <button id="registerButton">Register</button>
    <button id="forgotButton">Forgot Password</button>
  </div>

  <div style="display: none;" id="loggedPanel">
    <button id="signoutButton">Sign-out</button>

    <p>Current Discord: <span id="discordDisp"></span></p>

    <form id="discordForm">
      <label for="dispNameInput">Discord Username:</label>
      <input id="dispNameInput" type="text">
      <input type="submit" value="Submit">
    </form>

  </div>

  <div style="display: none;" id="adminPanel">
    <p>Users awaiting approval:</p>
    <table id="pendUserTable">
      <tr>
        <th>Nobody!</th>
      </tr>
    </table>
  </div>

  <div style="display: none;" id="approvedPanel">
    <p>You're approved now.</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {

      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE)
        .catch((error) => {
          alert(error.message);
        });

      const auth = firebase.auth();
      const db = firebase.database();
      const stor = firebase.storage();

      document.getElementById("registerButton").addEventListener("click", function (event) {
        auth.createUserWithEmailAndPassword(document.getElementById("mailInput").value, document.getElementById("passInput").value)
          .then((userCredential) => {
            db.ref(userCredential.user.uid).set({
              approved: false,
              admin: false,
            });
          })
          .catch((error) => {
            alert(error.message);
          });
      });

      document.getElementById("signinButton").addEventListener("click", function (event) {
        auth.signInWithEmailAndPassword(document.getElementById("mail").value, document.getElementById("pass").value)
          .catch((error) => {
            alert(error.message);
          });
      });

    });
  </script>
</body>

</html>